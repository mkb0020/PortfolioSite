<!-- templates/admin_orders.html -->
{% extends "base.html" %}
{% block title %}All Orders - Admin{% endblock %}
{% block content %}

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="admin-page-title">All Orders ({{ incomplete_count }} Incomplete)</h1>
        <div>
            <a href="{{ url_for('admin_real_purchases') }}" class="btn btn-danger">üî• Real Purchases Only</a>
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-back">‚Üê Back to Dashboard</a>
        </div>
    </div>

    <div class="about-section mb-4">  <!-- SEARCH BOX -->
        <div class="order-search-box">
            <h5 class="search-title">üîç Search Orders</h5>
            <form method="POST" action="{{ url_for('admin_orders_search') }}" class="search-form">
                <div class="row align-items-end">
                    <div class="col-md-9">
                        <label for="search_term" class="form-label search-label">Search by Order Number or Customer Email</label>
                        <input type="text" 
                               class="form-control search-input" 
                               id="search_term" 
                               name="search_term" 
                               placeholder="Enter order number (e.g., ORD-20250105-001) or email address"
                               value="{{ search_term if search_term else '' }}">
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-search w-100">Search</button>
                        {% if search_term %}
                        <a href="{{ url_for('admin_orders') }}" class="btn btn-clear-search w-100 mt-2">Clear Search</a>
                        {% endif %}
                    </div>
                </div>
            </form>
            {% if search_term %}
            <p class="search-results-text">Showing results for: <strong>{{ search_term }}</strong></p>
            {% endif %}
        </div>
    </div>

    <div class="about-section mb-4"> <!-- FILTER -->
        <div class="order-filter-box">
            <h5 class="filter-title">Filter by Status (click a status below to try it!) </h5>
            <div class="btn-group" role="group">
                <a href="{{ url_for('admin_orders') }}" 
                class="btn btn-sm {% if not filter_status %}btn-filter-active{% else %}btn-filter{% endif %}">
                    All Orders
                </a>
                <a href="{{ url_for('admin_orders', filter_status='real_pending') }}" 
                class="btn btn-sm {% if filter_status == 'real_pending' %}btn-filter-active{% else %}btn-filter{% endif %}">
                    Pending
                </a>
                <a href="{{ url_for('admin_orders', filter_status='processing') }}" 
                class="btn btn-sm {% if filter_status == 'processing' %}btn-filter-active{% else %}btn-filter{% endif %}">
                    Processing
                </a>
                <a href="{{ url_for('admin_orders', filter_status='shipped') }}" 
                class="btn btn-sm {% if filter_status == 'shipped' %}btn-filter-active{% else %}btn-filter{% endif %}">
                    Shipped
                </a>
                <a href="{{ url_for('admin_orders', filter_status='completed') }}" 
                class="btn btn-sm {% if filter_status == 'completed' %}btn-filter-active{% else %}btn-filter{% endif %}">
                    Completed
                </a>
            </div>
            {% if filter_status %}
            <p class="filter-results-text">Showing: <strong>{{ filter_status }}</strong> orders</p>
            {% endif %}
        </div>
    </div>

    {% if orders %}
    <div class="about-section">
        {% for order in orders %}
        <div class="card mb-4 {% if order.is_real_purchase %}order-card-real{% else %}order-card-demo{% endif %}">
            <div class="card-header order-card-header">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <h4 class="order-title">
                            Order #{{ order.order_number }}
                            {% if order.is_real_purchase %}
                            <span class="badge badge-real-purchase">üî• REAL PURCHASE</span>
                            {% else %}
                            <span class="badge badge-order-demo">DEMO ORDER</span>
                            {% endif %}
                        </h4>
                    </div>
                    <div class="col-md-6 text-end">
                        <span class="order-date">
                            {{ order.order_date.strftime('%m-%d-%Y') }}
                        </span>
                    </div>
                </div>
            </div>
            
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="section-title">Customer Information</h5>
                        <p class="info-text">
                            <strong>Name:</strong> {{ order.customer_name }}
                        </p>
                        <p class="info-text">
                            <strong>Email:</strong> 
                            <a href="mailto:{{ order.customer_email }}" class="email-link">
                                {{ order.customer_email }}
                            </a>
                        </p>
                        {% if order.customer_phone %}
                        <p class="info-text">
                            <strong>Phone:</strong> {{ order.customer_phone }}
                        </p>
                        {% endif %}
                        
                        <h5 class="section-title">Shipping Address</h5>
                        <p class="info-text address-text">
                            {{ order.address }}<br>
                            {{ order.city }}, {{ order.state }} {{ order.zip_code }}
                        </p>

                        <!-- TRACKING INFORMATION -->
                        <div class="tracking-section">
                            <h5 class="section-title">üì¶ Tracking Information</h5>
                            {% if order.tracking_number %}
                            <div class="tracking-display">
                                <p class="info-text">
                                    <strong>Tracking #:</strong> 
                                    <span class="tracking-number">{{ order.tracking_number }}</span>
                                </p>
                                {% if order.shipping_carrier %}
                                <p class="info-text">
                                    <strong>Carrier:</strong> {{ order.shipping_carrier }}
                                </p>
                                {% endif %}
                            </div>
                            {% endif %}
                            
                            <form method="POST" action="{{ url_for('update_tracking', order_id=order.order_id) }}" class="tracking-form">
                                <div class="row">
                                    <div class="col-md-7">
                                        <input type="text" 
                                               class="form-control form-control-sm" 
                                               name="tracking_number" 
                                               placeholder="Enter tracking number"
                                               value="{{ order.tracking_number if order.tracking_number else '' }}">
                                    </div>
                                    <div class="col-md-5">
                                        <select class="form-control form-control-sm" name="carrier">
                                            <option value="">Select carrier</option>
                                            <option value="USPS" {% if order.shipping_carrier == 'USPS' %}selected{% endif %}>USPS</option>
                                            <option value="FedEx" {% if order.shipping_carrier == 'FedEx' %}selected{% endif %}>FedEx</option>
                                            <option value="UPS" {% if order.shipping_carrier == 'UPS' %}selected{% endif %}>UPS</option>
                                            <option value="DHL" {% if order.shipping_carrier == 'DHL' %}selected{% endif %}>DHL</option>
                                            <option value="Other" {% if order.shipping_carrier == 'Other' %}selected{% endif %}>Other</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-sm btn-tracking-update mt-2">
                                    {% if order.tracking_number %}Update{% else %}Add{% endif %} Tracking
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <h5 class="section-title">Order Items</h5>
                        <ul class="order-items-list">
                            {% for item in order["items"] %}
                            <li>{{ item.item_name }} - ${{ "%.2f"|format(item.item_price) }}</li>
                            {% endfor %}
                        </ul>
                        
                        <div class="order-total-box">
                            <h4 class="total-amount">
                                Total: ${{ "%.2f"|format(order.total_amount) }}
                            </h4>
                        </div>
                        
                        <p class="order-status-text">
                            <strong>Status:</strong> 
                            <span class="badge badge-order-{{ order.order_status }}">{{ order.order_status }}</span>
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="card-footer order-card-footer">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <div>
                        <h6 class="update-status-title">Update Status:</h6>
                        <div class="btn-group btn-group-sm" role="group">
                            {% if order.order_status != 'demo' %}
                            <form method="POST" action="{{ url_for('update_order_status_route', order_id=order.order_id, status='demo') }}" style="display: inline;">
                                <button type="submit" class="btn btn-status-demo">Demo</button>
                            </form>
                            {% endif %}
                            
                            {% if order.order_status != 'real_pending' %}
                            <form method="POST" action="{{ url_for('update_order_status_route', order_id=order.order_id, status='real_pending') }}" style="display: inline;">
                                <button type="submit" class="btn btn-status-pending">Pending</button>
                            </form>
                            {% endif %}
                            
                            {% if order.order_status != 'processing' %}
                            <form method="POST" action="{{ url_for('update_order_status_route', order_id=order.order_id, status='processing') }}" style="display: inline;">
                                <button type="submit" class="btn btn-status-processing">Processing</button>
                            </form>
                            {% endif %}
                            
                            {% if order.order_status != 'shipped' %}
                            <form method="POST" action="{{ url_for('update_order_status_route', order_id=order.order_id, status='shipped') }}" style="display: inline;">
                                <button type="submit" class="btn btn-status-shipped">Shipped</button>
                            </form>
                            {% endif %}
                            
                            {% if order.order_status != 'completed' %}
                            <form method="POST" action="{{ url_for('update_order_status_route', order_id=order.order_id, status='completed') }}" style="display: inline;">
                                <button type="submit" class="btn btn-status-completed">Completed</button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div>
                        <form method="POST" action="{{ url_for('archive_order', order_id=order.order_id) }}" style="display: inline;" onsubmit="return confirm('Archive this order? It will be hidden but remain in the database.');">
                            <button type="submit" class="btn btn-sm btn-archive-order" title="Archive this order">
                                üì¶ Archive
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="demo-banner text-center">
        <h4>{% if search_term %}No orders found!{% else %}No orders yet!{% endif %}</h4>
        <p>{% if search_term %}Try a different search term.{% else %}When customers place orders, they'll appear here.{% endif %}</p>
    </div>
    {% endif %}
</div>

<style>
.btn-archive-order {
    background: linear-gradient(135deg, #8F93BA, #938FB7);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 5px;
    transition: all 0.3s;
}

.btn-archive-order:hover {
    background: linear-gradient(135deg, #938FB7, #A55AFF);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(143, 147, 186, 0.4);
}
</style>

{% endblock %}