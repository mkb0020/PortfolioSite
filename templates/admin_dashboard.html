<!-- templates/admin_dashboard.html -->
{% extends "base.html" %}
{% block title %}Admin Dashboard - MK Barriault{% endblock %}
{% block content %}

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üéõÔ∏è Admin Dashboard</h1>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger">Logout</a>
    </div>

    <!-- STATS OVERVIEW -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-body">
                    <h5 class="card-title">Contact Submissions</h5>
                    <h2>{{ stats.total_contacts }}</h2>
                    <a href="{{ url_for('admin_contacts') }}" class="btn btn-light btn-sm">View All</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-body">
                    <h5 class="card-title">Suggestions</h5>
                    <h2>{{ stats.total_suggestions }}</h2>
                    <a href="{{ url_for('admin_suggestions') }}" class="btn btn-light btn-sm">View All</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Orders</h5>
                    <h2>{{ stats.total_orders }}</h2>
                    <a href="{{ url_for('admin_orders') }}" class="btn btn-light btn-sm">View All</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-white bg-danger mb-3">
                <div class="card-body">
                    <h5 class="card-title">üî• Real Purchases</h5>
                    <h2>{{ stats.real_purchases }}</h2>
                    <a href="{{ url_for('admin_real_purchases') }}" class="btn btn-light btn-sm">View All</a>
                </div>
            </div>
        </div>
    </div>

    <!-- RECENT REAL PURCHASES ALERT -->
    {% if stats.real_purchases > 0 %}
    <div class="alert alert-warning" role="alert">
        <h4 class="alert-heading">üö® {{ stats.real_purchases }} Real Purchase Request(s)!</h4>
        <p>You have customers who want to actually buy your art/jewelry. Check the Real Purchases section!</p>
    </div>
    {% endif %}

    <!-- RECENT CONTACT SUBMISSIONS -->
    <div class="card mb-4">
        <div class="card-header">
            <h3>Recent Contact Submissions</h3>
        </div>
        <div class="card-body">
            {% if stats.recent_contacts %}
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Inquiry Type</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for contact in stats.recent_contacts %}
                    <tr>
                        <td>{{ contact.submitted_at.strftime('%Y-%m-%d %H:%M') if contact.submitted_at is not string else contact.submitted_at }}</td>
                        <td>{{ contact.name }}</td>
                        <td>{{ contact.email }}</td>
                        <td>{{ contact.inquiry_type }}</td>
                        <td>
                            <span class="badge bg-{{ 'success' if contact.status == 'read' else 'warning' }}">
                                {{ contact.status }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <a href="{{ url_for('admin_contacts') }}" class="btn btn-primary">View All Contacts</a>
            {% else %}
            <p>No contact submissions yet.</p>
            {% endif %}
        </div>
    </div>

    <!-- RECENT REAL PURCHASE ORDERS -->
    {% if stats.recent_real_orders %}
    <div class="card mb-4 border-danger">
        <div class="card-header bg-danger text-white">
            <h3>üî• Recent Real Purchase Requests</h3>
        </div>
        <div class="card-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Order #</th>
                        <th>Date</th>
                        <th>Customer</th>
                        <th>Email</th>
                        <th>Total</th>
                        <th>Items</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in stats.recent_real_orders %}
                    <tr>
                        <td><strong>{{ order.order_number }}</strong></td>
                        <td>{{ order.order_date.strftime('%Y-%m-%d %H:%M') if order.order_date is not string else order.order_date }}</td>
                        <td>{{ order.customer_name }}</td>
                        <td>{{ order.customer_email }}</td>
                        <td>${{ "%.2f"|format(order.total_amount) }}</td>
                        <td>
                            {% for item in order["items"] %}
                            {{ item.item_name }}<br>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <a href="{{ url_for('admin_real_purchases') }}" class="btn btn-danger">View All Real Purchases</a>
        </div>
    </div>
    {% endif %}

</div>

<style>
    .card {
        margin-bottom: 20px;
    }
    .table {
        color: white;
    }
    .badge {
        padding: 5px 10px;
    }
</style>

{% endblock %}
